"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[37616],{46007:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var i=n(74848),a=n(28453);const r={},o=void 0,s={id:"programming-languages/golang/topics/interface",title:"interface",description:"Go Data Structures: Interfaces",source:"@site/docs/00400-programming-languages/golang/topics/interface.md",sourceDirName:"00400-programming-languages/golang/topics",slug:"/programming-languages/golang/topics/interface",permalink:"/dddtdd-docs/programming-languages/golang/topics/interface",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1720187019e3,frontMatter:{},sidebar:"docSidebar",previous:{title:"email",permalink:"/dddtdd-docs/programming-languages/golang/topics/email"},next:{title:"reflection",permalink:"/dddtdd-docs/programming-languages/golang/topics/reflection"}},c={},l=[{value:"Go Data Structures: Interfaces",id:"go-data-structures-interfaces",level:2},{value:"Usage",id:"usage",level:3},{value:"Interface Values",id:"interface-values",level:3},{value:"Computing the Itable",id:"computing-the-itable",level:3},{value:"Memory Optimizations",id:"memory-optimizations",level:3}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"go-data-structures-interfaces",children:"Go Data Structures: Interfaces"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://research.swtch.com/interfaces",children:"https://research.swtch.com/interfaces"})}),"\n",(0,i.jsx)(t.h3,{id:"usage",children:"Usage"}),"\n",(0,i.jsxs)(t.p,{children:["Go's interfaces let you use ",(0,i.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Duck_typing",children:"duck typing"})," like you would in a purely dynamic language like Python but still have the compiler catch obvious mistakes like passing an int where an object with a Read method was expected, or like calling the Read method with the wrong number of arguments"]}),"\n",(0,i.jsx)(t.h3,{id:"interface-values",children:"Interface Values"}),"\n",(0,i.jsx)(t.p,{children:"Interface values are represented as a two-word pair giving a pointer to information about the type stored in the interface and a pointer to the associated data"}),"\n",(0,i.jsxs)(t.p,{children:["The first word in the interface value points at what I call an ",(0,i.jsx)(t.strong,{children:"interface table or itable"})," (pronounced i-table; in the runtime sources, the C implementation name is ",(0,i.jsx)(t.code,{children:"Itab"}),"). The itable begins with some metadata about the types involved and then becomes a list of function pointers. ",(0,i.jsx)(t.strong,{children:"Note that the itable corresponds to the interface type, not the dynamic type"}),". In terms of our example, the itable for Stringer holding type Binary lists the methods used to satisfy Stringer, which is just String: Binary's other methods (Get) make no appearance in the itable"]}),"\n",(0,i.jsxs)(t.p,{children:["The second word in the interface value points at the actual data, in this case a ",(0,i.jsx)(t.strong,{children:"copy"})," of b."]}),"\n",(0,i.jsxs)(t.p,{children:["To check whether an interface value holds a particular type, as in the type switch above, the Go compiler generates code equivalent to the C expression ",(0,i.jsx)(t.code,{children:"s.tab->type"})," to obtain the type pointer and check it against the desired type"]}),"\n",(0,i.jsxs)(t.p,{children:["To call s.String(), the Go compiler generates code that does the equivalent of the C expression ",(0,i.jsx)(t.code,{children:"s.tab->fun[0](s.data)"}),": it calls the appropriate function pointer from the itable, passing the interface value's data word as the function's first (in this example, only) argument."]}),"\n",(0,i.jsx)(t.h3,{id:"computing-the-itable",children:"Computing the Itable"}),"\n",(0,i.jsxs)(t.p,{children:["the compiler generates a type description structure for each ",(0,i.jsx)(t.strong,{children:"concrete type"})," like ",(0,i.jsx)(t.code,{children:"Binary"})," or ",(0,i.jsx)(t.code,{children:"int"})," or ",(0,i.jsx)(t.code,{children:"func(map[int]string)"}),". Among other metadata, the type description structure contains a list of the methods implemented by that type"]}),"\n",(0,i.jsxs)(t.p,{children:["the compiler generates a (different) type description structure for each ",(0,i.jsx)(t.strong,{children:"interface type"})," like Stringer; it too contains a method list"]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.strong,{children:"interface runtime"})," computes the itable by looking for each method listed in the interface type's method table in the concrete type's method table. The runtime caches the itable after generating it, so that this correspondence need only be computed once"]}),"\n",(0,i.jsxs)(t.p,{children:["By sorting the two method tables and walking them simultaneously, we can build the mapping in ",(0,i.jsx)(t.code,{children:"O(ni + nt)"})," time instead"]}),"\n",(0,i.jsx)(t.h3,{id:"memory-optimizations",children:"Memory Optimizations"}),"\n",(0,i.jsxs)(t.p,{children:["First, if the interface type involved is empty\u2014it has no methods\u2014then the itable serves no purpose except to hold the pointer to the original type. In this case, the itable can be dropped and the value can ",(0,i.jsx)(t.strong,{children:"point at the type directly"})]}),"\n",(0,i.jsxs)(t.p,{children:["Second, if the value associated with the interface value can fit in a single machine word, there's ",(0,i.jsx)(t.strong,{children:"no need to introduce the indirection"})," or the heap allocation"]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>s});var i=n(96540);const a={},r=i.createContext(a);function o(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);