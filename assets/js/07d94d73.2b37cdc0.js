"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[3451],{86094:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var a=t(74848),i=t(28453);const s={},o=void 0,r={id:"programming-languages/golang/cmd-go",title:"cmd-go",description:"https://pkg.go.dev/cmd/go",source:"@site/docs/00400-programming-languages/golang/cmd-go.md",sourceDirName:"00400-programming-languages/golang",slug:"/programming-languages/golang/cmd-go",permalink:"/dddtdd-docs/programming-languages/golang/cmd-go",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1720187019e3,frontMatter:{},sidebar:"docSidebar",previous:{title:"basics",permalink:"/dddtdd-docs/programming-languages/golang/basics"},next:{title:"\u7f16\u8bd1",permalink:"/dddtdd-docs/programming-languages/golang/compile"}},l={},d=[{value:"Compile packages and dependencies",id:"compile-packages-and-dependencies",level:2},{value:"Print Go environment information",id:"print-go-environment-information",level:2},{value:"Generate Go files by processing source",id:"generate-go-files-by-processing-source",level:2},{value:"Add dependencies to current module and install them",id:"add-dependencies-to-current-module-and-install-them",level:2},{value:"Download modules to local cache",id:"download-modules-to-local-cache",level:2},{value:"Initialize new module in current directory",id:"initialize-new-module-in-current-directory",level:2},{value:"Add missing and remove unused modules",id:"add-missing-and-remove-unused-modules",level:2},{value:"Verify dependencies have expected content",id:"verify-dependencies-have-expected-content",level:2},{value:"Compile and run Go program",id:"compile-and-run-go-program",level:2},{value:"Test packages",id:"test-packages",level:2},{value:"Report likely mistakes in packages",id:"report-likely-mistakes-in-packages",level:2},{value:"Build constraints",id:"build-constraints",level:2},{value:"Build modes",id:"build-modes",level:2},{value:"Internal Directories",id:"internal-directories",level:2},{value:"Package lists and patterns",id:"package-lists-and-patterns",level:2},{value:"Testing flags",id:"testing-flags",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://pkg.go.dev/cmd/go",children:"https://pkg.go.dev/cmd/go"})}),"\n",(0,a.jsx)(n.h2,{id:"compile-packages-and-dependencies",children:"Compile packages and dependencies"}),"\n",(0,a.jsxs)(n.p,{children:["When compiling packages, build ignores files that end in ",(0,a.jsx)(n.code,{children:"_test.go"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"When compiling a single main package, build writes the resulting executable to an output file named after the last non-major-version component of the package import path"}),"\n",(0,a.jsx)(n.h2,{id:"print-go-environment-information",children:"Print Go environment information"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go env [-json] [-u] [-w] [var ...]\n"})}),"\n",(0,a.jsx)(n.h2,{id:"generate-go-files-by-processing-source",children:"Generate Go files by processing source"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go generate [-run regexp] [-n] [-v] [-x] [build flags] [file.go... | packages]\n"})}),"\n",(0,a.jsx)(n.p,{children:"Go generate scans the file for directives, which are lines of the form"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:"//go:generate command argument...\n"})}),"\n",(0,a.jsx)(n.p,{children:"The arguments to the directive are space-separated tokens or double-quoted strings passed to the generator as individual arguments when it is run."}),"\n",(0,a.jsx)(n.p,{children:"Quoted strings use Go syntax and are evaluated before execution; a quoted string appears as a single argument to the generator"}),"\n",(0,a.jsxs)(n.p,{children:["As a last step before running the command, any invocations of any environment variables with alphanumeric names, such as ",(0,a.jsx)(n.code,{children:"$GOFILE"})," or ",(0,a.jsx)(n.code,{children:"$HOME"}),", are expanded throughout the command line"]}),"\n",(0,a.jsx)(n.p,{children:"A directive of the form"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:"//go:generate -command xxx args...\n"})}),"\n",(0,a.jsxs)(n.p,{children:["specifies, for the remainder of this source file only, that the string xxx represents the command identified by the arguments. This can be used to create ",(0,a.jsx)(n.strong,{children:"aliases"})," or to handle multiword generators"]}),"\n",(0,a.jsx)(n.p,{children:'Generate processes packages in the order given on the command line, one at a time. If the command line lists .go files from a single directory, they are treated as a single package. Within a package, generate processes the source files in a package in file name order, one at a time. Within a source file, generate runs generators in the order they appear in the file, one at a time. The go generate tool also sets the build tag "generate" so that files may be examined by go generate but ignored during build'}),"\n",(0,a.jsx)(n.h2,{id:"add-dependencies-to-current-module-and-install-them",children:"Add dependencies to current module and install them"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go get [-t] [-u] [-v] [build flags] [packages]\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Get resolves its command-line arguments to packages at specific module versions, ",(0,a.jsx)(n.strong,{children:"updates go.mod to require those versions, and downloads source code into the module cache"})]}),"\n",(0,a.jsx)(n.h2,{id:"download-modules-to-local-cache",children:"Download modules to local cache"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go mod download [-x] [-json] [-reuse=old.json] [modules]\n"})}),"\n",(0,a.jsx)(n.h2,{id:"initialize-new-module-in-current-directory",children:"Initialize new module in current directory"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go mod init [module-path]\n"})}),"\n",(0,a.jsx)(n.h2,{id:"add-missing-and-remove-unused-modules",children:"Add missing and remove unused modules"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go mod tidy [-e] [-v] [-x] [-go=version] [-compat=version]\n"})}),"\n",(0,a.jsx)(n.h2,{id:"verify-dependencies-have-expected-content",children:"Verify dependencies have expected content"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go mod verify\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Verify checks that the dependencies of the current module, which are stored in a local downloaded source cache, have ",(0,a.jsx)(n.strong,{children:"not been modified since being downloaded"})]}),"\n",(0,a.jsx)(n.h2,{id:"compile-and-run-go-program",children:"Compile and run Go program"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go run [build flags] [-exec xprog] package [arguments...]\n"})}),"\n",(0,a.jsx)(n.h2,{id:"test-packages",children:"Test packages"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go test [build/test flags] [packages] [build/test flags & test binary flags]\n"})}),"\n",(0,a.jsxs)(n.p,{children:["'Go test' recompiles each package along with any files with names matching the file pattern ",(0,a.jsx)(n.code,{children:"*_test.go"}),". These additional files can contain test functions, benchmark functions, fuzz tests and example functions. See ",(0,a.jsx)(n.code,{children:"go help testfunc"})," for more. Each listed package causes the execution of a ",(0,a.jsx)(n.strong,{children:"separate test binary"}),". Files whose names begin with ",(0,a.jsx)(n.strong,{children:'"_" (including "_test.go") or "." are ignored'})]}),"\n",(0,a.jsxs)(n.p,{children:["Test files that declare a package with the suffix ",(0,a.jsx)(n.code,{children:"_test"})," will be compiled as a separate package, and then linked and run with the main test binary"]}),"\n",(0,a.jsxs)(n.p,{children:["The go tool will ignore a directory named ",(0,a.jsx)(n.code,{children:"testdata"}),", making it available to hold ancillary data needed by the tests"]}),"\n",(0,a.jsxs)(n.p,{children:["As part of building a test binary, go test runs ",(0,a.jsx)(n.code,{children:"go vet"})," on the package and its test source files to identify significant problems"]}),"\n",(0,a.jsx)(n.h2,{id:"report-likely-mistakes-in-packages",children:"Report likely mistakes in packages"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"go vet [build flags] [-vettool prog] [vet flags] [packages]\n"})}),"\n",(0,a.jsx)(n.h2,{id:"build-constraints",children:"Build constraints"}),"\n",(0,a.jsx)(n.p,{children:"A build constraint, also known as a build tag, is a condition under which a file should be included in the package"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:"//go:build (linux && 386) || (darwin && !cgo)\n"})}),"\n",(0,a.jsx)(n.p,{children:"Constraints may appear in any kind of source file (not just Go), but they must appear near the top of the file, preceded only by blank lines and other comments. These rules mean that in Go files a build constraint must appear before the package clause"}),"\n",(0,a.jsx)(n.p,{children:"To distinguish build constraints from package documentation, a build constraint should be followed by a blank line"}),"\n",(0,a.jsxs)(n.p,{children:["A build constraint comment is evaluated as an expression containing build tags combined by ",(0,a.jsx)(n.code,{children:"||, &&, and ! operators and parentheses"})]}),"\n",(0,a.jsxs)(n.p,{children:["It is an error for a file to have more than one ",(0,a.jsx)(n.code,{children:"//go:build"})," line."]}),"\n",(0,a.jsx)(n.p,{children:"During a particular build, the following build tags are satisfied:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"the target operating system, as spelled by runtime.GOOS, set with the GOOS environment variable."}),"\n",(0,a.jsx)(n.li,{children:"the target architecture, as spelled by runtime.GOARCH, set with the GOARCH environment variable."}),"\n",(0,a.jsx)(n.li,{children:'any architecture features, in the form GOARCH.feature (for example, "amd64.v2"), as detailed below.'}),"\n",(0,a.jsx)(n.li,{children:'"unix", if GOOS is a Unix or Unix-like system.'}),"\n",(0,a.jsx)(n.li,{children:'the compiler being used, either "gc" or "gccgo"'}),"\n",(0,a.jsx)(n.li,{children:"\"cgo\", if the cgo command is supported (see CGO_ENABLED in 'go help environment')."}),"\n",(0,a.jsx)(n.li,{children:'a term for each Go major release, through the current version: "go1.1" from Go version 1.1 onward, "go1.12" from Go 1.12, and so on.'}),"\n",(0,a.jsx)(n.li,{children:"any additional tags given by the -tags flag (see 'go help build')"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["If a file's name, after stripping the extension and a possible ",(0,a.jsx)(n.code,{children:"_test"})," suffix, matches any of the following patterns"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"*_GOOS\n*_GOARCH\n*_GOOS_GOARCH\n"})}),"\n",(0,a.jsxs)(n.p,{children:["(example: source_windows_amd64.go) where GOOS and GOARCH represent any known operating system and architecture values respectively, then the file is considered to have an ",(0,a.jsx)(n.strong,{children:"implicit build constraint"})," requiring those terms (in addition to any explicit constraints in the file)"]}),"\n",(0,a.jsx)(n.h2,{id:"build-modes",children:"Build modes"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"-buildmode=archive\n\tBuild the listed non-main packages into .a files. Packages named\n\tmain are ignored.\n\n-buildmode=c-archive\n\tBuild the listed main package, plus all packages it imports,\n\tinto a C archive file. The only callable symbols will be those\n\tfunctions exported using a cgo //export comment. Requires\n\texactly one main package to be listed.\n\n-buildmode=c-shared\n\tBuild the listed main package, plus all packages it imports,\n\tinto a C shared library. The only callable symbols will\n\tbe those functions exported using a cgo //export comment.\n\tRequires exactly one main package to be listed.\n\n-buildmode=default\n\tListed main packages are built into executables and listed\n\tnon-main packages are built into .a files (the default\n\tbehavior).\n\n-buildmode=shared\n\tCombine all the listed non-main packages into a single shared\n\tlibrary that will be used when building with the -linkshared\n\toption. Packages named main are ignored.\n\n-buildmode=exe\n\tBuild the listed main packages and everything they import into\n\texecutables. Packages not named main are ignored.\n\n-buildmode=pie\n\tBuild the listed main packages and everything they import into\n\tposition independent executables (PIE). Packages not named\n\tmain are ignored.\n\n-buildmode=plugin\n\tBuild the listed main packages, plus all packages that they\n\timport, into a Go plugin. Packages not named main are ignored.\n"})}),"\n",(0,a.jsx)(n.h2,{id:"internal-directories",children:"Internal Directories"}),"\n",(0,a.jsxs)(n.p,{children:['Code in or below a directory named "internal" is ',(0,a.jsx)(n.strong,{children:"importable only by"}),' code in the directory tree rooted at the parent of "internal"']}),"\n",(0,a.jsx)(n.h2,{id:"package-lists-and-patterns",children:"Package lists and patterns"}),"\n",(0,a.jsx)(n.p,{children:"There are four reserved names for paths that should not be used for packages to be built with the go tool:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:'"main" denotes the top-level package in a stand-alone executable.'}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:'"all" expands to all packages found in all the GOPATH trees. For example, \'go list all\' lists all the packages on the local system. When using modules, "all" expands to all packages in the main module and their dependencies, including dependencies needed by tests of any of those.'}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:'"std" is like all but expands to just the packages in the standard Go library.'}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:'"cmd" expands to the Go repository\'s commands and their internal libraries'}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["An import path is a pattern if it includes one or more ",(0,a.jsx)(n.strong,{children:'"..." wildcards'}),", each of which can match any string, including the empty string and strings containing slashes"]}),"\n",(0,a.jsxs)(n.p,{children:["Packages in a program need not have unique package names, but there are two reserved package names with special meaning. The name ",(0,a.jsx)(n.code,{children:"main"})," indicates a command, not a library. Commands are built into binaries and cannot be imported. The name ",(0,a.jsx)(n.code,{children:"documentation"})," indicates documentation for a non-Go program in the directory. Files in package documentation are ignored by the go command"]}),"\n",(0,a.jsxs)(n.p,{children:["Directory and file names that begin with ",(0,a.jsx)(n.strong,{children:'"." or "_"'})," are ignored by the go tool, as are directories named ",(0,a.jsx)(n.strong,{children:'"testdata"'})]}),"\n",(0,a.jsx)(n.h2,{id:"testing-flags",children:"Testing flags"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"-benchtime t\n    Run enough iterations of each benchmark to take t, specified\n    as a time.Duration (for example, -benchtime 1h30s).\n    The default is 1 second (1s).\n    The special syntax Nx means to run the benchmark N times\n    (for example, -benchtime 100x).\n\n-cover\n    Enable coverage analysis.\n    Note that because coverage works by annotating the source\n    code before compilation, compilation and test failures with\n    coverage enabled may report line numbers that don't correspond\n    to the original sources.\n\n-failfast\n    Do not start new tests after the first test failure\n\n-run regexp\n    Run only those tests, examples, and fuzz tests matching the regular\n    expression. For tests, the regular expression is split by unbracketed\n    slash (/) characters into a sequence of regular expressions, and each\n    part of a test's identifier must match the corresponding element in\n    the sequence, if any. Note that possible parents of matches are\n    run too, so that -run=X/Y matches and runs and reports the result\n    of all tests matching X, even those without sub-tests matching Y,\n    because it must run them to look for those sub-tests.\n    See also -skip\n\n-short\n    Tell long-running tests to shorten their run time.\n    It is off by default but set during all.bash so that installing\n    the Go tree can run a sanity check but not spend time running\n    exhaustive tests\n\n-timeout d\n    If a test binary runs longer than duration d, panic.\n    If d is 0, the timeout is disabled.\n    The default is 10 minutes (10m)\n\n-v\n    Verbose output: log all tests as they are run. Also print all\n    text from Log and Logf calls even if the test succeeds                        \n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"-benchmem\n    Print memory allocation statistics for benchmarks.\n\n-blockprofile block.out\n    Write a goroutine blocking profile to the specified file\n    when all tests are complete.\n    Writes test binary as -c would\n\n-cpuprofile cpu.out\n    Write a CPU profile to the specified file before exiting.\n    Writes test binary as -c would\n\n-memprofile mem.out\n    Write an allocation profile to the file after all tests have passed.\n    Writes test binary as -c would\n\n-mutexprofile mutex.out\n    Write a mutex contention profile to the specified file\n    when all tests are complete.\n    Writes test binary as -c would            \n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var a=t(96540);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);