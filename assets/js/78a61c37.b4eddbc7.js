"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[77605],{60310:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>f,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var n=r(74848),c=r(28453);const a={},s="Reactivity in Depth",i={id:"frontend/vue3/core/extras/reactivity-in-depth",title:"Reactivity in Depth",description:"How Reactivity Works in Vue",source:"@site/docs/00200-frontend/vue3/010-core/018-extras/020-reactivity-in-depth.md",sourceDirName:"00200-frontend/vue3/010-core/018-extras",slug:"/frontend/vue3/core/extras/reactivity-in-depth",permalink:"/dddtdd-docs/frontend/vue3/core/extras/reactivity-in-depth",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1720187019e3,sidebarPosition:20,frontMatter:{},sidebar:"docSidebar",previous:{title:"Composition API FAQ",permalink:"/dddtdd-docs/frontend/vue3/core/extras/composition-api-faq"},next:{title:"Rendering Mechanism",permalink:"/dddtdd-docs/frontend/vue3/core/extras/rendering-mechanism"}},o={},d=[{value:"How Reactivity Works in Vue",id:"how-reactivity-works-in-vue",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"reactivity-in-depth",children:"Reactivity in Depth"}),"\n",(0,n.jsx)(t.h2,{id:"how-reactivity-works-in-vue",children:"How Reactivity Works in Vue"}),"\n",(0,n.jsxs)(t.p,{children:["There are two ways of intercepting property access in JavaScript: ",(0,n.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/get#description",children:"getter"})," / ",(0,n.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/set#description",children:"setters"})," and ",(0,n.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",children:"Proxies"})]}),"\n",(0,n.jsxs)(t.p,{children:["In Vue 3, ",(0,n.jsx)(t.strong,{children:"Proxies are used for reactive objects and getter / setters are used for refs"})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"function reactive(obj) {\r\n  return new Proxy(obj, {\r\n    get(target, key) {\r\n      track(target, key)\r\n      return target[key]\r\n    },\r\n    set(target, key, value) {\r\n      target[key] = value\r\n      trigger(target, key)\r\n    }\r\n  })\r\n}\r\n\r\nfunction ref(value) {\r\n  const refObject = {\r\n    get value() {\r\n      track(refObject, 'value')\r\n      return value\r\n    },\r\n    set value(newValue) {\r\n      value = newValue\r\n      trigger(refObject, 'value')\r\n    }\r\n  }\r\n  return refObject\r\n}\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"// This will be set right before an effect is about\r\n// to be run. We'll deal with this later.\r\nlet activeEffect\r\n\r\nfunction track(target, key) {\r\n  if (activeEffect) {\r\n    const effects = getSubscribersForProperty(target, key)\r\n    effects.add(activeEffect)\r\n  }\r\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Effect subscriptions are stored in a global ",(0,n.jsx)(t.code,{children:"WeakMap<target, Map<key, Set<effect>>>"})," data structure"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"function trigger(target, key) {\r\n  const effects = getSubscribersForProperty(target, key)\r\n  effects.forEach((effect) => effect())\r\n}\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"function whenDepsChange(update) {\r\n  const effect = () => {\r\n    activeEffect = effect\r\n    update()\r\n    activeEffect = null\r\n  }\r\n  effect()\r\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["At this point, we have created an effect that automatically tracks its dependencies, and re-runs whenever a dependency changes. We call this a ",(0,n.jsx)(t.strong,{children:"Reactive Effect"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["Vue provides an API that allows you to create reactive effects: ",(0,n.jsx)(t.a,{href:"https://vuejs.org/api/reactivity-core#watcheffect",children:"watchEffect()"})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"import { ref, watchEffect } from 'vue'\r\n\r\nconst count = ref(0)\r\n\r\nwatchEffect(() => {\r\n  document.body.innerHTML = `Count is: ${count.value}`\r\n})\r\n\r\n// updates the DOM\r\ncount.value++\n"})})]})}function f(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},28453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>i});var n=r(96540);const c={},a=n.createContext(c);function s(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);