"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[4168],{50416:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var i=t(74848),s=t(28453);const r={},o=void 0,a={id:"programming-languages/python/pep/2010-0393-Flexible-String-Representation",title:"2010-0393-Flexible-String-Representation",description:"https://peps.python.org/pep-0393/",source:"@site/docs/00400-programming-languages/python/pep/2010-0393-Flexible-String-Representation.md",sourceDirName:"00400-programming-languages/python/pep",slug:"/programming-languages/python/pep/2010-0393-Flexible-String-Representation",permalink:"/dddtdd-docs/programming-languages/python/pep/2010-0393-Flexible-String-Representation",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1720187019e3,frontMatter:{},sidebar:"docSidebar",previous:{title:"2009-3148-futures-execute-computations-asynchronously",permalink:"/dddtdd-docs/programming-languages/python/pep/2009-3148-futures-execute-computations-asynchronously"},next:{title:"2011-0405-Python-Virtual-Environments",permalink:"/dddtdd-docs/programming-languages/python/pep/2011-0405-Python-Virtual-Environments"}},c={},d=[{value:"Rationale",id:"rationale",level:2},{value:"Specification",id:"specification",level:2},{value:"String Creation",id:"string-creation",level:3},{value:"String Access",id:"string-access",level:3}];function p(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://peps.python.org/pep-0393/",children:"https://peps.python.org/pep-0393/"})}),"\n",(0,i.jsxs)(n.p,{children:["The Unicode string type is changed to support ",(0,i.jsx)(n.strong,{children:"multiple internal representations"}),", depending on the character with the largest Unicode ordinal"]}),"\n",(0,i.jsx)(n.h2,{id:"rationale",children:"Rationale"}),"\n",(0,i.jsxs)(n.p,{children:["As interaction with other libraries will often require some sort of internal representation, the specification chooses ",(0,i.jsx)(n.strong,{children:"UTF-8 as the recommended way of exposing strings to C code"})]}),"\n",(0,i.jsx)(n.h2,{id:"specification",children:"Specification"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"typedef struct {\n  PyObject_HEAD\n  Py_ssize_t length;\n  Py_hash_t hash;\n  struct {\n      unsigned int interned:2;\n      unsigned int kind:2;\n      unsigned int compact:1;\n      unsigned int ascii:1;\n      unsigned int ready:1;\n  } state;\n  wchar_t *wstr;\n} PyASCIIObject;\n\ntypedef struct {\n  PyASCIIObject _base;\n  Py_ssize_t utf8_length;\n  char *utf8;\n  Py_ssize_t wstr_length;\n} PyCompactUnicodeObject;\n\ntypedef struct {\n  PyCompactUnicodeObject _base;\n  union {\n      void *any;\n      Py_UCS1 *latin1;\n      Py_UCS2 *ucs2;\n      Py_UCS4 *ucs4;\n  } data;\n} PyUnicodeObject;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"string-creation",children:"String Creation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"PyObject* PyUnicode_New(Py_ssize_t size, Py_UCS4 maxchar);\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"PyUnicode_READY()"})," converts a string containing only a wstr representation into the canonical representation. Unless wstr and data can share the memory, the wstr representation is discarded after the conversion"]}),"\n",(0,i.jsx)(n.h3,{id:"string-access",children:"String Access"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"PyUnicode_READ(kind, data, index)\nPyUnicode_WRITE(kind, data, index, value)\nPyUnicode_READ_CHAR(unicode, index)\n"})})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);