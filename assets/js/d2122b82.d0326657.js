"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[99122],{37743:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>t,toc:()=>r});var l=i(74848),d=i(28453);const c={title:"Module Objects"},o=void 0,t={id:"programming-languages/python/c-api/concrete-module",title:"Module Objects",description:"- PyTypeObject PyModule_Type",source:"@site/docs/00400-programming-languages/python/c-api/0990-concrete-module.md",sourceDirName:"00400-programming-languages/python/c-api",slug:"/programming-languages/python/c-api/concrete-module",permalink:"/dddtdd-docs/programming-languages/python/c-api/concrete-module",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1720187019e3,sidebarPosition:990,frontMatter:{title:"Module Objects"},sidebar:"docSidebar",previous:{title:"File Objects",permalink:"/dddtdd-docs/programming-languages/python/c-api/concrete-file"},next:{title:"Iterator Objects",permalink:"/dddtdd-docs/programming-languages/python/c-api/concrete-iterator"}},s={},r=[{value:"Initializing C modules",id:"initializing-c-modules",level:2},{value:"Single-phase initialization",id:"single-phase-initialization",level:3},{value:"Multi-phase initialization",id:"multi-phase-initialization",level:3},{value:"Low-level module creation functions",id:"low-level-module-creation-functions",level:3},{value:"Support functions",id:"support-functions",level:3},{value:"Module lookup",id:"module-lookup",level:2}];function h(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyTypeObject PyModule_Type"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_Check(PyObject *p)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_CheckExact(PyObject *p)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyModule_NewObject(PyObject *name)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyModule_New(const char *name)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyModule_GetDict(PyObject *module)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyModule_GetNameObject(PyObject *module)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"const char *PyModule_GetName(PyObject *module)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"void *PyModule_GetState(PyObject *module)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyModuleDef *PyModule_GetDef(PyObject *module)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyModule_GetFilenameObject(PyObject *module)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"const char *PyModule_GetFilename(PyObject *module)"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"initializing-c-modules",children:"Initializing C modules"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"type PyModuleDef"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyModuleDef_Base m_base"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"const char *m_name"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"const char *m_doc"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Py_ssize_t m_size"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyMethodDef *m_methods"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyModuleDef_Slot *m_slots"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"inquiry m_reload"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"traverseproc m_traverse"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"inquiry m_clear"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"freefunc m_free"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"single-phase-initialization",children:"Single-phase initialization"}),"\n",(0,l.jsx)(n.p,{children:"The module initialization function may create and return the module object directly. This is referred to as \u201csingle-phase initialization\u201d"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyModule_Create(PyModuleDef *def)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyModule_Create2(PyModuleDef *def, int module_api_version)"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"multi-phase-initialization",children:"Multi-phase initialization"}),"\n",(0,l.jsxs)(n.p,{children:["Extension modules created this way behave more like Python modules: the initialization is split between the creation phase, when the module object is created, and the execution phase, when it is populated. The distinction is similar to the ",(0,l.jsx)(n.code,{children:"__new__()"})," and ",(0,l.jsx)(n.code,{children:"__init__()"})," methods of classes."]}),"\n",(0,l.jsxs)(n.p,{children:["To request multi-phase initialization, the initialization function (PyInit_modulename) returns a ",(0,l.jsx)(n.code,{children:"PyModuleDef"})," instance with non-empty ",(0,l.jsx)(n.code,{children:"m_slots"}),"."]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyModuleDef_Init(PyModuleDef *def)"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"type PyModuleDef_Slot"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int slot"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"void *value"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Py_mod_create"})," : ",(0,l.jsx)(n.code,{children:"PyObject *create_module(PyObject *spec, PyModuleDef *def)"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Py_mod_exec"})," : ",(0,l.jsx)(n.code,{children:"int exec_module(PyObject *module)"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"low-level-module-creation-functions",children:"Low-level module creation functions"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyModule_FromDefAndSpec(PyModuleDef *def, PyObject *spec)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_ExecDef(PyObject *module, PyModuleDef *def)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_SetDocString(PyObject *module, const char *docstring)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_AddFunctions(PyObject *module, PyMethodDef *functions)"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"support-functions",children:"Support functions"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_AddObjectRef(PyObject *module, const char *name, PyObject *value)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_AddObject(PyObject *module, const char *name, PyObject *value)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_AddIntConstant(PyObject *module, const char *name, long value)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_AddStringConstant(PyObject *module, const char *name, const char *value)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyModule_AddIntMacro(module, macro)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyModule_AddStringMacro(module, macro)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyModule_AddType(PyObject *module, PyTypeObject *type)"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"module-lookup",children:"Module lookup"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PyObject *PyState_FindModule(PyModuleDef *def)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyState_AddModule(PyObject *module, PyModuleDef *def)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"int PyState_RemoveModule(PyModuleDef *def)"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>t});var l=i(96540);const d={},c=l.createContext(d);function o(e){const n=l.useContext(c);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:o(e.components),l.createElement(c.Provider,{value:n},e.children)}}}]);