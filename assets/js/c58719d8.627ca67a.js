"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[60214],{77954:(t,e,r)=>{r.r(e),r.d(e,{assets:()=>m,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var o=r(74848),n=r(28453);const s={},a=void 0,c={id:"topic/test/httprunner/startup",title:"startup",description:"hrp\\cmd\\cli\\main.go",source:"@site/docs/00800-topic/test/httprunner/00200-startup.md",sourceDirName:"00800-topic/test/httprunner",slug:"/topic/test/httprunner/startup",permalink:"/dddtdd-docs/topic/test/httprunner/startup",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1720187019e3,sidebarPosition:200,frontMatter:{},sidebar:"docSidebar",previous:{title:"concept",permalink:"/dddtdd-docs/topic/test/httprunner/concept"},next:{title:"boomer",permalink:"/dddtdd-docs/topic/test/httprunner/boomer"}},m={},d=[{value:"hrp\\cmd\\cli\\main.go",id:"hrpcmdclimaingo",level:2},{value:"hrp\\cmd\\root.go",id:"hrpcmdrootgo",level:2},{value:"hrp\\cmd\\run.go",id:"hrpcmdrungo",level:2},{value:"hrp\\cmd\\boom.go",id:"hrpcmdboomgo",level:2}];function i(t){const e={code:"code",h2:"h2",pre:"pre",...(0,n.R)(),...t.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h2,{id:"hrpcmdclimaingo",children:"hrp\\cmd\\cli\\main.go"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",metastring:'title="hrp\\cmd\\cli\\main.go"',children:"func main() {\n\n\texitCode := cmd.Execute()\n\tos.Exit(exitCode)    \n"})}),"\n",(0,o.jsx)(e.h2,{id:"hrpcmdrootgo",children:"hrp\\cmd\\root.go"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'func Execute() int {\n\trootCmd.PersistentFlags().StringVarP(&logLevel, "log-level", "l", "INFO", "set log level")\n\trootCmd.PersistentFlags().BoolVar(&logJSON, "log-json", false, "set log to json format")\n\trootCmd.PersistentFlags().StringVar(&venv, "venv", "", "specify python3 venv path")\n\n\terr := rootCmd.Execute()\n\treturn code.GetErrorCode(err)\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"hrpcmdrungo",children:"hrp\\cmd\\run.go"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"var runCmd = &cobra.Command{\n\tRunE: func(cmd *cobra.Command, args []string) error {\n\t\t...\n\t\trunner := makeHRPRunner()\n\t\treturn runner.Run(paths...)\t\n\t\t\nfunc makeHRPRunner() *hrp.HRPRunner {\n\trunner := hrp.NewRunner(nil).\n\t\tSetFailfast(!continueOnFailure).\n\t\tSetSaveTests(saveTests).\n\t\tSetCaseTimeout(caseTimeout)\t\t\n"})}),"\n",(0,o.jsx)(e.h2,{id:"hrpcmdboomgo",children:"hrp\\cmd\\boom.go"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'var boomCmd = &cobra.Command{\n\n\tRunE: func(cmd *cobra.Command, args []string) (err error) {\n\t\t\n\t\tvar hrpBoomer *hrp.HRPBoomer\n\t\tif boomArgs.master {\n\t\t\thrpBoomer = hrp.NewMasterBoomer(boomArgs.masterBindHost, boomArgs.masterBindPort)\n\t\t} else if boomArgs.worker {\n\t\t\thrpBoomer = hrp.NewWorkerBoomer(boomArgs.masterHost, boomArgs.masterPort)\n\t\t} else {\n\t\t\thrpBoomer = hrp.NewStandaloneBoomer(boomArgs.SpawnCount, boomArgs.SpawnRate)\n\t\t}\n\t\t\n\t\tswitch hrpBoomer.GetMode() {\n\t\tcase "master":\n\t\t\thrpBoomer.SetTestCasesPath(args)\n\t\t\tif boomArgs.autoStart {\n\t\t\t\thrpBoomer.SetAutoStart()\n\t\t\t\thrpBoomer.SetExpectWorkers(boomArgs.expectWorkers, boomArgs.expectWorkersMaxWait)\n\t\t\t\thrpBoomer.SetSpawnCount(boomArgs.SpawnCount)\n\t\t\t\thrpBoomer.SetSpawnRate(boomArgs.SpawnRate)\n\t\t\t\thrpBoomer.SetRunTime(boomArgs.RunTime)\n\t\t\t}\n\t\t\tif boomArgs.autoStart {\n\t\t\t\thrpBoomer.InitBoomer()\n\t\t\t} else {\n\t\t\t\tgo hrpBoomer.StartServer(ctx, boomArgs.masterHttpAddress)\n\t\t\t}\n\t\t\tgo hrpBoomer.PollTestCases(ctx)\n\t\t\thrpBoomer.RunMaster()\n\t\tcase "worker":\n\t\t\tif boomArgs.ignoreQuit {\n\t\t\t\thrpBoomer.SetIgnoreQuit()\n\t\t\t}\n\t\t\tgo hrpBoomer.PollTasks(ctx)\n\t\t\thrpBoomer.RunWorker()\n\t\tcase "standalone":\n\t\t\tif venv != "" {\n\t\t\t\thrpBoomer.SetPython3Venv(venv)\n\t\t\t}\n\t\t\thrpBoomer.InitBoomer()\n\t\t\thrpBoomer.Run(paths...)\n\t\t}\t\t\n'})})]})}function p(t={}){const{wrapper:e}={...(0,n.R)(),...t.components};return e?(0,o.jsx)(e,{...t,children:(0,o.jsx)(i,{...t})}):i(t)}},28453:(t,e,r)=>{r.d(e,{R:()=>a,x:()=>c});var o=r(96540);const n={},s=o.createContext(n);function a(t){const e=o.useContext(s);return o.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function c(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(n):t.components||n:a(t.components),o.createElement(s.Provider,{value:e},t.children)}}}]);