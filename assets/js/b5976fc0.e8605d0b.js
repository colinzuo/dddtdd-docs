"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[8769],{77763:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>o});var s=t(74848),i=t(28453);const r={title:"Elk"},l=void 0,a={id:"cloud/elk",title:"Elk",description:"Fork github docker-elk",source:"@site/docs/00500-cloud/elk.md",sourceDirName:"00500-cloud",slug:"/cloud/elk",permalink:"/dddtdd-docs/cloud/elk",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1720225565e3,frontMatter:{title:"Elk"},sidebar:"docSidebar",previous:{title:"Docker",permalink:"/dddtdd-docs/cloud/docker"},next:{title:"GKE",permalink:"/dddtdd-docs/cloud/gcloud"}},c={},o=[{value:"Fork github docker-elk",id:"fork-github-docker-elk",level:2},{value:"Create a branch",id:"create-a-branch",level:2},{value:"Modify Settings",id:"modify-settings",level:2},{value:"docker-compose.yml",id:"docker-composeyml",level:3},{value:"elasticsearch/config/elasticsearch.yml",id:"elasticsearchconfigelasticsearchyml",level:3},{value:"prepare images",id:"prepare-images",level:3},{value:"prepare directories",id:"prepare-directories",level:3},{value:"startup containers",id:"startup-containers",level:3},{value:"setting-up-user-authentication",id:"setting-up-user-authentication",level:3},{value:"Setup Filebeat",id:"setup-filebeat",level:3},{value:"Setup Index Patterns on Kibana",id:"setup-index-patterns-on-kibana",level:3},{value:"Save Popular Search",id:"save-popular-search",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"fork-github-docker-elk",children:"Fork github docker-elk"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/deviantony/docker-elk",children:"https://github.com/deviantony/docker-elk"})}),"\n",(0,s.jsx)(n.h2,{id:"create-a-branch",children:"Create a branch"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git checkout -b autotest\ngit push --set-upstream origin autotest\n"})}),"\n",(0,s.jsx)(n.h2,{id:"modify-settings",children:"Modify Settings"}),"\n",(0,s.jsx)(n.h3,{id:"docker-composeyml",children:"docker-compose.yml"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"elasticsearch"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'-      - type: volume\n-        source: elasticsearch\n+      - type: bind\n+        source: /srv/elk/elasticsearch\n\n-      ES_JAVA_OPTS: "-Xmx256m -Xms256m"\n+      ES_JAVA_OPTS: "-Xmx2048m -Xms2048m"\n\n-volumes:\n-  elasticsearch:\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"logstash"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'+      - "5044:5044/tcp"\n+      - "5044:5044/udp"\n\n-      LS_JAVA_OPTS: "-Xmx256m -Xms256m"\n+      LS_JAVA_OPTS: "-Xmx2048m -Xms2048m"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"elasticsearchconfigelasticsearchyml",children:"elasticsearch/config/elasticsearch.yml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"-xpack.license.self_generated.type: trial\n+xpack.license.self_generated.type: basic\n"})}),"\n",(0,s.jsx)(n.h3,{id:"prepare-images",children:"prepare images"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/colinzuo/kubernetes",children:"https://github.com/colinzuo/kubernetes"})}),"\n",(0,s.jsx)(n.p,{children:"pull from docker.elastic.co"}),"\n",(0,s.jsx)(n.p,{children:"push to private registry"}),"\n",(0,s.jsx)(n.p,{children:"login to private registry"}),"\n",(0,s.jsx)(n.h3,{id:"prepare-directories",children:"prepare directories"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir -p /srv/elk/elasticsearch\nchown 1000:1000 /srv/elk/elasticsearch\n"})}),"\n",(0,s.jsx)(n.h3,{id:"startup-containers",children:"startup containers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose up -d\n"})}),"\n",(0,s.jsx)(n.h3,{id:"setting-up-user-authentication",children:"setting-up-user-authentication"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/deviantony/docker-elk#setting-up-user-authentication",children:"https://github.com/deviantony/docker-elk#setting-up-user-authentication"})}),"\n",(0,s.jsx)(n.h3,{id:"setup-filebeat",children:"Setup Filebeat"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/colinzuo/beats",children:"https://github.com/colinzuo/beats"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Load Template"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"export   ELASTICSEARCH_HOSTS=172.16.23.70:9200\nexport ELASTICSEARCH_USERNAME=elastic\nexport ELASTICSEARCH_PASSWORD=ezhTRZKhX2ItULXy1tXd\n\n./filebeat -c filebeat.yml.orig setup --index-management -E output.logstash.enabled=false\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create Configuration file"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(10278).A+"",children:"Sample Configuration"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Start filebeat"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nohup ./filebeat -c filebeat_auto_portal.yml > start_filebeat_log.txt 2>&1 &\n"})}),"\n",(0,s.jsx)(n.h3,{id:"setup-index-patterns-on-kibana",children:"Setup Index Patterns on Kibana"}),"\n",(0,s.jsx)(n.p,{children:"such as"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"filebeat-autotest-audit-*"}),"\n",(0,s.jsx)(n.li,{children:"filebeat-autotest-norm-*"}),"\n",(0,s.jsx)(n.li,{children:"logstash-*"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"save-popular-search",children:"Save Popular Search"})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},10278:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/files/filebeat_auto_portal-b4b368a37bcd9198e5732ebb86fa97a3.yml"},28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var s=t(96540);const i={},r=s.createContext(i);function l(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);