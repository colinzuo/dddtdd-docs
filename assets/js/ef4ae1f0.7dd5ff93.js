"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[80931],{1881:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>a,frontMatter:()=>r,metadata:()=>d,toc:()=>i});var t=s(74848),o=s(28453);const r={},c=void 0,d={id:"frontend/vue3/element-plus/components/internal/focus-trap",title:"focus-trap",description:"tokens.ts",source:"@site/docs/00200-frontend/vue3/element-plus/components/0300-internal/0200-focus-trap.md",sourceDirName:"00200-frontend/vue3/element-plus/components/0300-internal",slug:"/frontend/vue3/element-plus/components/internal/focus-trap",permalink:"/dddtdd-docs/frontend/vue3/element-plus/components/internal/focus-trap",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1720187019e3,sidebarPosition:200,frontMatter:{},sidebar:"docSidebar",previous:{title:"overlay",permalink:"/dddtdd-docs/frontend/vue3/element-plus/components/internal/overlay"},next:{title:"dialog",permalink:"/dddtdd-docs/frontend/vue3/element-plus/components/feedback/dialog"}},l={},i=[{value:"tokens.ts",id:"tokensts",level:2},{value:"utils.ts",id:"utilsts",level:2},{value:"useFocusReason",id:"usefocusreason",level:3},{value:"focus-trap.vue",id:"focus-trapvue",level:2},{value:"props",id:"props",level:3},{value:"emits",id:"emits",level:3},{value:"component setup",id:"component-setup",level:3}];function u(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"tokensts",children:"tokens.ts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"FOCUS_AFTER_TRAPPED"}),"\n",(0,t.jsx)(n.li,{children:"FOCUS_AFTER_RELEASED"}),"\n",(0,t.jsx)(n.li,{children:"FOCUSOUT_PREVENTED"}),"\n",(0,t.jsx)(n.li,{children:"FOCUS_AFTER_TRAPPED_OPTS"}),"\n",(0,t.jsx)(n.li,{children:"FOCUSOUT_PREVENTED_OPTS"}),"\n",(0,t.jsx)(n.li,{children:"ON_TRAP_FOCUS_EVT"}),"\n",(0,t.jsx)(n.li,{children:"ON_RELEASE_FOCUS_EVT"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"utilsts",children:"utils.ts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["obtainAllFocusableElements: \u901a\u8fc7",(0,t.jsx)(n.code,{children:"document.createTreeWalker"}),"\u548c",(0,t.jsx)(n.code,{children:"node.tabIndex >= 0"}),"\u83b7\u53d6\u5217\u8868"]}),"\n",(0,t.jsx)(n.li,{children:"getVisibleElement: \u627e\u5230\u5217\u8868\u7b2c\u4e00\u4e2avisible element"}),"\n",(0,t.jsxs)(n.li,{children:["getEdges: ",(0,t.jsx)(n.code,{children:"obtainAllFocusableElements"})," -> ",(0,t.jsx)(n.code,{children:"getVisibleElement"})]}),"\n",(0,t.jsxs)(n.li,{children:["tryFocus: \u5982\u679c\u80fdfocus\u5219\u8c03\u7528",(0,t.jsx)(n.code,{children:"element.focus({ preventScroll: true })"}),", ",(0,t.jsx)(n.code,{children:"element.select()"})]}),"\n",(0,t.jsxs)(n.li,{children:["focusFirstDescendant\uff1a\u6328\u4e2a\u5c1d\u8bd5\uff0c\u76f4\u5230",(0,t.jsx)(n.code,{children:"document.activeElement"}),"\u6539\u53d8"]}),"\n",(0,t.jsx)(n.li,{children:"focusableStack"}),"\n",(0,t.jsx)(n.li,{children:"isFocusCausedByUserEvent"}),"\n",(0,t.jsxs)(n.li,{children:["useFocusReason: ",(0,t.jsx)(n.code,{children:"focusReason = ref<'pointer' | 'keyboard'>()"})]}),"\n",(0,t.jsx)(n.li,{children:"createFocusOutPreventedEvent"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"usefocusreason",children:"useFocusReason"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"      document.addEventListener('mousedown', notifyFocusReasonPointer)\n      document.addEventListener('touchstart', notifyFocusReasonPointer)\n      document.addEventListener('keydown', notifyFocusReasonKeydown)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"focus-trapvue",children:"focus-trap.vue"}),"\n",(0,t.jsx)(n.h3,{id:"props",children:"props"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"  props: {\n    loop: Boolean,\n    trapped: Boolean,\n    focusTrapEl: Object as PropType<HTMLElement>,\n    focusStartEl: {\n      type: [Object, String] as PropType<'container' | 'first' | HTMLElement>,\n      default: 'first',\n    },\n  },\n"})}),"\n",(0,t.jsx)(n.h3,{id:"emits",children:"emits"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"  emits: [\n    ON_TRAP_FOCUS_EVT,\n    ON_RELEASE_FOCUS_EVT,\n    'focusin',\n    'focusout',\n    'focusout-prevented',\n    'release-requested',\n  ],\n"})}),"\n",(0,t.jsx)(n.h3,{id:"component-setup",children:"component setup"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["escape key: ",(0,t.jsx)(n.code,{children:"!focusLayer.paused"}),"\u4e5f\u5c31\u662f\u6700\u4e0a\u5c42focusLayer\uff0c",(0,t.jsx)(n.code,{children:"emit('release-requested', event)"})]}),"\n",(0,t.jsxs)(n.li,{children:["onKeydown: \u5f53\u6309\u952etab\u4e14\u6b63\u5e38\u5e94\u8be5focus\u79bb\u5f00\u5f53\u524dcontainer\u65f6\uff0c\uff0c\u9650\u5236focus\u53ea\u5728\u5185\u90e8\u53d8\u5316\uff0c\u5e76\u53d1\u9001",(0,t.jsx)(n.code,{children:"emit('focusout-prevented', focusoutPreventedEvent)"})]}),"\n",(0,t.jsxs)(n.li,{children:["onFocusOut: \u5982\u679c",(0,t.jsx)(n.code,{children:"props.trapped"}),"\u4e3a\u771f\u5219, \u53d1\u9001",(0,t.jsx)(n.code,{children:"emit('focusout-prevented', focusoutPreventedEvent)"}),", ",(0,t.jsx)(n.code,{children:"tryFocus(lastFocusAfterTrapped, true)"})]}),"\n",(0,t.jsxs)(n.li,{children:["startTrap: \u5982\u679c\u5f53\u524dfocus\u5728\u5916\u90e8\uff0c\u5219\u5c1d\u8bd5focus ",(0,t.jsx)(n.code,{children:"props.focusStartEl"}),"\uff0c\u5982\u679c\u5931\u8d25\u5219\u5c1d\u8bd5",(0,t.jsx)(n.code,{children:"tryFocus(trapContainer)"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"    useEscapeKeydown((event) => {\n      if (props.trapped && !focusLayer.paused) {\n        emit('release-requested', event)\n      }\n    })\n\n    const onKeydown = (e: KeyboardEvent) => {....\n\n    provide(FOCUS_TRAP_INJECTION_KEY, {\n      focusTrapRef: forwardRef,\n      onKeydown,\n    })    \n\n    watch([forwardRef], ([forwardRef], [oldForwardRef]) => {\n      if (forwardRef) {\n        forwardRef.addEventListener('keydown', onKeydown)\n        forwardRef.addEventListener('focusin', onFocusIn)\n        forwardRef.addEventListener('focusout', onFocusOut)\n      }    \n"})})]})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>d});var t=s(96540);const o={},r=t.createContext(o);function c(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);