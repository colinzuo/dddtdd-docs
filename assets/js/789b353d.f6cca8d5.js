"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[52074],{71815:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var t=n(74848),r=n(28453);const o={},i="Stubs, Spies, and Clocks",c={id:"frontend/cypress/guides/stubs-spies-and-clocks",title:"Stubs, Spies, and Clocks",description:"What you'll learn",source:"@site/docs/00200-frontend/cypress/060-guides/080-stubs-spies-and-clocks.md",sourceDirName:"00200-frontend/cypress/060-guides",slug:"/frontend/cypress/guides/stubs-spies-and-clocks",permalink:"/dddtdd-docs/frontend/cypress/guides/stubs-spies-and-clocks",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1721530274e3,sidebarPosition:80,frontMatter:{},sidebar:"docSidebar",previous:{title:"Screenshots and Videos",permalink:"/dddtdd-docs/frontend/cypress/guides/screenshots-and-videos"},next:{title:"Test Retries",permalink:"/dddtdd-docs/frontend/cypress/guides/test-retries"}},l={},d=[{value:"What you&#39;ll learn",id:"what-youll-learn",level:2},{value:"Capabilities",id:"capabilities",level:2},{value:"Libraries and Tools",id:"libraries-and-tools",level:2},{value:"Common Scenarios",id:"common-scenarios",level:2},{value:"Stubs",id:"stubs",level:3},{value:"Spies",id:"spies",level:3},{value:"Clock",id:"clock",level:3}];function a(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"stubs-spies-and-clocks",children:"Stubs, Spies, and Clocks"}),"\n",(0,t.jsx)(s.h2,{id:"what-youll-learn",children:"What you'll learn"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Which libraries Cypress includes to provide typical testing functionality"}),"\n",(0,t.jsx)(s.li,{children:"How to use stubs for asserting that code was called but preventing it from executing"}),"\n",(0,t.jsx)(s.li,{children:"How to use spies for asserting that code was called without interfering with its execution"}),"\n",(0,t.jsx)(s.li,{children:"How to control time for deterministically testing code that is time-dependent"}),"\n",(0,t.jsx)(s.li,{children:"How Cypress improves and extends the included libraries"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"capabilities",children:"Capabilities"}),"\n",(0,t.jsxs)(s.p,{children:["Cypress comes built in with the ability to stub and spy with ",(0,t.jsx)(s.code,{children:"cy.stub()"}),", ",(0,t.jsx)(s.code,{children:"cy.spy()"})," or modify your application's time with ",(0,t.jsx)(s.code,{children:"cy.clock()"})," - which lets you manipulate ",(0,t.jsx)(s.code,{children:"Date"}),", ",(0,t.jsx)(s.code,{children:"setTimeout"}),", ",(0,t.jsx)(s.code,{children:"clearTimeout"}),", ",(0,t.jsx)(s.code,{children:"setInterval"}),", or ",(0,t.jsx)(s.code,{children:"clearInterval"})]}),"\n",(0,t.jsx)(s.h2,{id:"libraries-and-tools",children:"Libraries and Tools"}),"\n",(0,t.jsx)(s.p,{children:"Cypress automatically bundles and wraps these libraries:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"sinon"}),"\tprovides the ",(0,t.jsx)(s.code,{children:"cy.stub()"})," and ",(0,t.jsx)(s.code,{children:"cy.spy()"})," APIs"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"lolex"}),"\tprovides the ",(0,t.jsx)(s.code,{children:"cy.clock()"})," and ",(0,t.jsx)(s.code,{children:"cy.tick()"})," APIs"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"sinon-chai"}),"\tadds ",(0,t.jsx)(s.code,{children:"chai"})," assertions for stubs and spies"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,t.jsx)(s.h3,{id:"stubs",children:"Stubs"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"// create a standalone stub (generally for use in unit test)\r\ncy.stub()\r\n\r\n// replace obj.method() with a stubbed function\r\ncy.stub(obj, 'method')\r\n\r\n// force obj.method() to return \"foo\"\r\ncy.stub(obj, 'method').returns('foo')\r\n\r\n// force obj.method() when called with \"bar\" argument to return \"foo\"\r\ncy.stub(obj, 'method').withArgs('bar').returns('foo')\r\n\r\n// force obj.method() to return a promise which resolves to \"foo\"\r\ncy.stub(obj, 'method').resolves('foo')\r\n\r\n// force obj.method() to return a promise rejected with an error\r\ncy.stub(obj, 'method').rejects(new Error('foo'))\n"})}),"\n",(0,t.jsx)(s.h3,{id:"spies",children:"Spies"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"cy.spy(obj, 'method')\n"})}),"\n",(0,t.jsx)(s.h3,{id:"clock",children:"Clock"}),"\n",(0,t.jsxs)(s.p,{children:["With ",(0,t.jsx)(s.code,{children:"cy.clock()"})," you can control:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Date"}),"\n",(0,t.jsx)(s.li,{children:"setTimeout"}),"\n",(0,t.jsx)(s.li,{children:"setInterval"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"cy.clock()\r\ncy.visit('http://localhost:3333')\r\ncy.get('#search').type('Acme Company')\r\ncy.tick(1000)\r\n// more test code here\r\n\r\n// restore the clock\r\ncy.clock().then((clock) => {\r\n  clock.restore()\r\n})\r\n// more test code here\n"})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>c});var t=n(96540);const r={},o=t.createContext(r);function i(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);