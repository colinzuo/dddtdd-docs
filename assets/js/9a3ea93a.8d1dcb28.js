"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[89795],{48712:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>i});var s=t(74848),r=t(28453);const l={title:"Rancher"},c=void 0,a={id:"cloud/rancher",title:"Rancher",description:"The following section teaches you how to setup Rancher.",source:"@site/docs/00500-cloud/rancher.md",sourceDirName:"00500-cloud",slug:"/cloud/rancher",permalink:"/dddtdd-docs/cloud/rancher",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1720187019e3,frontMatter:{title:"Rancher"},sidebar:"docSidebar",previous:{title:"Operator",permalink:"/dddtdd-docs/cloud/operator"},next:{title:"\u4e2d\u95f4\u4ef6\u4ecb\u7ecd",permalink:"/dddtdd-docs/middleware/"}},o={},i=[{value:"Introduction",id:"introduction",level:2},{value:"How to Install Docker",id:"how-to-install-docker",level:2},{value:"Install Rancher",id:"install-rancher",level:2},{value:"Setup VM such as GCE",id:"setup-vm-such-as-gce",level:3},{value:"Install and Set Up kubectl",id:"install-and-set-up-kubectl",level:3},{value:"Install RKE",id:"install-rke",level:3},{value:"Config kubectl config",id:"config-kubectl-config",level:3},{value:"Install Helm",id:"install-helm",level:3},{value:"Install Rancher Itself",id:"install-rancher-itself",level:3},{value:"Modify hosts file to add hostname entry for Web Client",id:"modify-hosts-file-to-add-hostname-entry-for-web-client",level:3},{value:"Create RKE template",id:"create-rke-template",level:3},{value:"Create Cluster",id:"create-cluster",level:3},{value:"Modify cattle-cluster-agent to add host-aliases",id:"modify-cattle-cluster-agent-to-add-host-aliases",level:3},{value:"Modify hosts file to add hostname entry for k8s Nodes",id:"modify-hosts-file-to-add-hostname-entry-for-k8s-nodes",level:3},{value:"Resource Reservation",id:"resource-reservation",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["The following section teaches you how to setup ",(0,s.jsx)(n.a,{href:"https://rancher.com/",children:"Rancher"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsxs)(n.p,{children:["We will use ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/",children:"kubernetes"})," to orchestrate the docker containers.\nTo manage kuernete clusters, there are free tools like ",(0,s.jsx)(n.a,{href:"https://rancher.com/",children:"Rancher"}),",\n",(0,s.jsx)(n.a,{href:"https://kubesphere.io/en/",children:"KubeSphere"}),", and we choose ",(0,s.jsx)(n.a,{href:"https://rancher.com/",children:"Rancher"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"how-to-install-docker",children:"How to Install Docker"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/dddtdd-docs/cloud/docker",children:"Setup Docker"})}),"\n",(0,s.jsx)(n.h2,{id:"install-rancher",children:"Install Rancher"}),"\n",(0,s.jsx)(n.h3,{id:"setup-vm-such-as-gce",children:"Setup VM such as GCE"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/dddtdd-docs/cloud/gcloud",children:"Setup GCE"})}),"\n",(0,s.jsx)(n.h3,{id:"install-and-set-up-kubectl",children:"Install and Set Up kubectl"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/dddtdd-docs/cloud/kubernetes/",children:"Install and Set Up kubectl"})}),"\n",(0,s.jsx)(n.h3,{id:"install-rke",children:"Install RKE"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://rancher.com/docs/rke/latest/en/installation/",children:"https://rancher.com/docs/rke/latest/en/installation/"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://rancher.com/docs/rancher/v2.x/en/backups/backups/ha-backups/",children:"BackupConfig"})}),"\n",(0,s.jsx)(n.p,{children:"Sample cluster.yml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'nodes:\n    - address: 10.128.0.2\n      user: colinzuo\n      role: [controlplane, worker, etcd]\n\nservices:\n  etcd:\n    backup_config:\n      enabled: true     # enables recurring etcd snapshots\n      interval_hours: 6 # time increment between snapshots\n      retention: 7     # time in days before snapshot purge\n\n# Required for external TLS termination with\n# ingress-nginx v0.22+\ningress:\n  provider: nginx\n  options:\n    use-forwarded-headers: "true"\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"rke up\n"})}),"\n",(0,s.jsx)(n.h3,{id:"config-kubectl-config",children:"Config kubectl config"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/.kube\ncp kube_config_cluster.yml ~/.kube/rancher_config\n# edit ~/.profile\nexport KUBECONFIG=$HOME/.kube/rancher_config\n"})}),"\n",(0,s.jsx)(n.h3,{id:"install-helm",children:"Install Helm"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/dddtdd-docs/cloud/helm/",children:"Install Helm"})}),"\n",(0,s.jsx)(n.h3,{id:"install-rancher-itself",children:"Install Rancher Itself"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"helm repo add rancher-stable https://releases.rancher.com/server-charts/stable\n\nkubectl apply -f https://raw.githubusercontent.com/jetstack/cert-manager/release-0.12/deploy/manifests/00-crds.yaml\n\nkubectl create namespace cert-manager\n\nhelm repo add jetstack https://charts.jetstack.io\n\nhelm repo update\n\nhelm install \\\n  cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --version v0.12.0\n\nkubectl get pods --namespace cert-manager\n\nhelm install rancher rancher-stable/rancher \\\n  --namespace cattle-system \\\n  --set hostname=ranchercz1.myorg.com\n\nkubectl -n cattle-system rollout status deploy/rancher\n"})}),"\n",(0,s.jsx)(n.h3,{id:"modify-hosts-file-to-add-hostname-entry-for-web-client",children:"Modify hosts file to add hostname entry for Web Client"}),"\n",(0,s.jsx)(n.p,{children:"such as for windows"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"10.128.0.2 ranchercz1.myorg.com\n"})}),"\n",(0,s.jsx)(n.h3,{id:"create-rke-template",children:"Create RKE template"}),"\n",(0,s.jsx)(n.p,{children:"as needed"}),"\n",(0,s.jsx)(n.h3,{id:"create-cluster",children:"Create Cluster"}),"\n",(0,s.jsx)(n.p,{children:"take GKE for ex"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Enable Identity and Access Management (IAM) API\n",(0,s.jsx)(n.a,{href:"https://console.developers.google.com/apis/api/iam.googleapis.com/overview?project=PROJECT_ID",children:"https://console.developers.google.com/apis/api/iam.googleapis.com/overview?project=PROJECT_ID"})]}),"\n",(0,s.jsxs)(n.li,{children:["Enable Kubernetes Engine API\n",(0,s.jsx)(n.a,{href:"https://console.developers.google.com/apis/api/container.googleapis.com/overview?project=731260793637",children:"https://console.developers.google.com/apis/api/container.googleapis.com/overview?project=731260793637"})]}),"\n",(0,s.jsxs)(n.li,{children:["Create a Service Account with roles","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Compute Viewer"}),"\n",(0,s.jsx)(n.li,{children:"Project Viewer"}),"\n",(0,s.jsx)(n.li,{children:"Kubernetes Engine Admin"}),"\n",(0,s.jsx)(n.li,{children:"Service Account User"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"modify-cattle-cluster-agent-to-add-host-aliases",children:"Modify cattle-cluster-agent to add host-aliases"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/",children:"https://kubernetes.io/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"      - hostnames:\n        - ranchercz1.myorg.com\n        ip: 10.128.0.2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"modify-hosts-file-to-add-hostname-entry-for-k8s-nodes",children:"Modify hosts file to add hostname entry for k8s Nodes"}),"\n",(0,s.jsx)(n.p,{children:"/etc/hosts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"10.128.0.2 ranchercz1.myorg.com\n"})}),"\n",(0,s.jsx)(n.h3,{id:"resource-reservation",children:"Resource Reservation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl describe nodes\n\nkubectl get po --all-namespaces -o=jsonpath=\"{range .items[*]}{.metadata.namespace}:{.metadata.name}{'\\n'}{range .spec.containers[*]}  {.name}:{.resources.requests.cpu}{'\\n'}{end}{'\\n'}{end}\"\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>a});var s=t(96540);const r={},l=s.createContext(r);function c(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);