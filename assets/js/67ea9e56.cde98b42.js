"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[20135],{97010:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>s});var c=t(74848),i=t(28453);const r={},a="Architecture",d={id:"programming-languages/python/libs/pydantic/architecture",title:"Architecture",description:"Usage of the Pydantic library can be divided into two parts:",source:"@site/docs/00400-programming-languages/python/libs/pydantic/210-architecture.md",sourceDirName:"00400-programming-languages/python/libs/pydantic",slug:"/programming-languages/python/libs/pydantic/architecture",permalink:"/dddtdd-docs/programming-languages/python/libs/pydantic/architecture",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1734870983e3,sidebarPosition:210,frontMatter:{},sidebar:"docSidebar",previous:{title:"pydantic_core.core_schema",permalink:"/dddtdd-docs/programming-languages/python/libs/pydantic/pydantic_core_schema"},next:{title:"Resolving Annotations",permalink:"/dddtdd-docs/programming-languages/python/libs/pydantic/resolving_annotations"}},o={},s=[{value:"Model definition",id:"model-definition",level:2},{value:"Communicating between <code>pydantic</code> and <code>pydantic-core</code>: the core schema",id:"communicating-between-pydantic-and-pydantic-core-the-core-schema",level:3},{value:"Customizing the core schema and JSON schema",id:"customizing-the-core-schema-and-json-schema",level:3}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h1,{id:"architecture",children:"Architecture"}),"\n",(0,c.jsx)(n.p,{children:"Usage of the Pydantic library can be divided into two parts:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Model definition, done in the ",(0,c.jsx)(n.code,{children:"pydantic"})," package."]}),"\n",(0,c.jsxs)(n.li,{children:["Model validation and serialization, done in the ",(0,c.jsx)(n.code,{children:"pydantic-core"})," package"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"model-definition",children:"Model definition"}),"\n",(0,c.jsxs)(n.p,{children:["Whenever a Pydantic ",(0,c.jsx)(n.code,{children:"BaseModel"})," is defined, the ",(0,c.jsx)(n.strong,{children:"metaclass"})," will analyze the body of the model to collect a number of elements:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Defined annotations to build model fields (collected in the ",(0,c.jsx)(n.code,{children:"model_fields"})," attribute)."]}),"\n",(0,c.jsxs)(n.li,{children:["Model configuration, set with ",(0,c.jsx)(n.code,{children:"model_config"}),"."]}),"\n",(0,c.jsx)(n.li,{children:"Additional validators/serializers."}),"\n",(0,c.jsx)(n.li,{children:"Private attributes, class variables, identification of generic parametrization, etc"}),"\n"]}),"\n",(0,c.jsxs)(n.h3,{id:"communicating-between-pydantic-and-pydantic-core-the-core-schema",children:["Communicating between ",(0,c.jsx)(n.code,{children:"pydantic"})," and ",(0,c.jsx)(n.code,{children:"pydantic-core"}),": the core schema"]}),"\n",(0,c.jsxs)(n.p,{children:["Pydantic uses the concept of a ",(0,c.jsx)(n.strong,{children:"core schema"}),": a structured (and serializable) Python dictionary (represented using ",(0,c.jsx)(n.code,{children:"TypedDict"})," definitions) describing a specific validation and serialization logic"]}),"\n",(0,c.jsx)(n.h3,{id:"customizing-the-core-schema-and-json-schema",children:"Customizing the core schema and JSON schema"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-py",children:"from typing import Any\r\n\r\nfrom pydantic_core import CoreSchema\r\nfrom typing import Annotated\r\n\r\nfrom pydantic import GetCoreSchemaHandler, TypeAdapter\r\n\r\n\r\nclass MyStrict:\r\n    @classmethod\r\n    def __get_pydantic_core_schema__(\r\n        cls, source: Any, handler: GetCoreSchemaHandler\r\n    ) -> CoreSchema:\r\n        schema = handler(source)  \r\n        schema['strict'] = True\r\n        return schema\r\n\r\n\r\nclass MyGt:\r\n    @classmethod\r\n    def __get_pydantic_core_schema__(\r\n        cls, source: Any, handler: GetCoreSchemaHandler\r\n    ) -> CoreSchema:\r\n        schema = handler(source)  \r\n        schema['gt'] = 1\r\n        return schema\r\n\r\n\r\nta = TypeAdapter(Annotated[int, MyStrict(), MyGt()])\n"})}),"\n",(0,c.jsxs)(n.p,{children:["When the ",(0,c.jsx)(n.code,{children:"GenerateSchema"})," class builds the core schema for ",(0,c.jsx)(n.code,{children:"Annotated[int, MyStrict(), MyGt()]"}),", it will create an instance of a ",(0,c.jsx)(n.code,{children:"GetCoreSchemaHandler"})," to be passed to the ",(0,c.jsx)(n.code,{children:"MyGt.__get_pydantic_core_schema__"})," method."]}),"\n",(0,c.jsxs)(n.p,{children:["In the case of our ",(0,c.jsx)(n.code,{children:"Annotated"})," pattern, the ",(0,c.jsx)(n.code,{children:"GetCoreSchemaHandler"})," is defined in a nested way. Calling it will ",(0,c.jsx)(n.strong,{children:"recursively"})," call the other ",(0,c.jsx)(n.code,{children:"__get_pydantic_core_schema__"})," methods until it reaches the ",(0,c.jsx)(n.code,{children:"int"})," annotation, where a simple ",(0,c.jsx)(n.code,{children:"{'type': 'int'}"})," schema is returned"]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"source"})," argument depends on the core schema generation pattern. In the case of ",(0,c.jsx)(n.code,{children:"Annotated"}),", the source will be the ",(0,c.jsx)(n.strong,{children:"type being annotated"}),". When defining a custom type, the source will be the actual class where ",(0,c.jsx)(n.code,{children:"__get_pydantic_core_schema__"})," is defined"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>d});var c=t(96540);const i={},r=c.createContext(i);function a(e){const n=c.useContext(r);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),c.createElement(r.Provider,{value:n},e.children)}}}]);