"use strict";(self.webpackChunkdoc_center=self.webpackChunkdoc_center||[]).push([[61036],{93247:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>s,default:()=>p,frontMatter:()=>l,metadata:()=>o,toc:()=>a});var r=i(74848),d=i(28453);const l={},s="Serialization",o={id:"programming-languages/python/libs/pydantic/serialization",title:"Serialization",description:"model.model_dump(...)",source:"@site/docs/00400-programming-languages/python/libs/pydantic/050-serialization.md",sourceDirName:"00400-programming-languages/python/libs/pydantic",slug:"/programming-languages/python/libs/pydantic/serialization",permalink:"/dddtdd-docs/programming-languages/python/libs/pydantic/serialization",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1734870983e3,sidebarPosition:50,frontMatter:{},sidebar:"docSidebar",previous:{title:"Configuration",permalink:"/dddtdd-docs/programming-languages/python/libs/pydantic/config"},next:{title:"Validators",permalink:"/dddtdd-docs/programming-languages/python/libs/pydantic/validators"}},t={},a=[{value:"<code>model.model_dump(...)</code>",id:"modelmodel_dump",level:2},{value:"<code>model.model_dump_json(...)</code>",id:"modelmodel_dump_json",level:2},{value:"Custom serializers",id:"custom-serializers",level:2},{value:"Serializing subclasses",id:"serializing-subclasses",level:2},{value:"Serializing with duck-typing",id:"serializing-with-duck-typing",level:3},{value:"<code>model_copy(...)</code>",id:"model_copy",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"serialization",children:"Serialization"}),"\n",(0,r.jsx)(n.h2,{id:"modelmodel_dump",children:(0,r.jsx)(n.code,{children:"model.model_dump(...)"})}),"\n",(0,r.jsxs)(n.p,{children:["This is the primary way of converting a model to a dictionary. Sub-models will be ",(0,r.jsx)(n.strong,{children:"recursively converted to dictionaries"})]}),"\n",(0,r.jsx)(n.h2,{id:"modelmodel_dump_json",children:(0,r.jsx)(n.code,{children:"model.model_dump_json(...)"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:".model_dump_json()"})," method serializes a model directly to a ",(0,r.jsx)(n.strong,{children:"JSON-encoded string"})," that is equivalent to the result produced by ",(0,r.jsx)(n.code,{children:".model_dump()"})]}),"\n",(0,r.jsx)(n.h2,{id:"custom-serializers",children:"Custom serializers"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"class WithCustomEncoders(BaseModel):\r\n    model_config = ConfigDict(ser_json_timedelta='iso8601')\r\n\r\n    dt: datetime\r\n    diff: timedelta\r\n\r\n    @field_serializer('dt')\r\n    def serialize_dt(self, dt: datetime, _info):\r\n        return dt.timestamp()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In addition, ",(0,r.jsx)(n.code,{children:"PlainSerializer"})," and ",(0,r.jsx)(n.code,{children:"WrapSerializer"})," enable you to use a function to modify the output of serialization."]}),"\n",(0,r.jsx)(n.p,{children:"Both serializers accept optional arguments including:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"return_type"})," specifies the return type for the function. If omitted it will be inferred from the type annotation."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"when_used"})," specifies when this serializer should be used. Accepts a string with values ",(0,r.jsx)(n.code,{children:"'always'"}),", ",(0,r.jsx)(n.code,{children:"'unless-none'"}),", ",(0,r.jsx)(n.code,{children:"'json'"}),", and ",(0,r.jsx)(n.code,{children:"'json-unless-none'"}),". Defaults to ",(0,r.jsx)(n.code,{children:"'always'"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"from pydantic.functional_serializers import PlainSerializer\r\n\r\nFancyInt = Annotated[\r\n    int, PlainSerializer(lambda x: f'{x:,}', return_type=str, when_used='json')\r\n]\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"def ser_wrap(v: Any, nxt: SerializerFunctionWrapHandler) -> str:\r\n    return f'{nxt(v + 1):,}'\r\n\r\n\r\nFancyInt = Annotated[int, WrapSerializer(ser_wrap, when_used='json')]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"serializing-subclasses",children:"Serializing subclasses"}),"\n",(0,r.jsx)(n.h3,{id:"serializing-with-duck-typing",children:"Serializing with duck-typing"}),"\n",(0,r.jsx)(n.p,{children:"If you want v1-style duck-typing serialization behavior, you can use a runtime setting, or annotate individual types."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Field / type level: use the ",(0,r.jsx)(n.code,{children:"SerializeAsAny"})," annotation"]}),"\n",(0,r.jsxs)(n.li,{children:["Runtime level: use the ",(0,r.jsx)(n.code,{children:"serialize_as_any"})," flag when calling ",(0,r.jsx)(n.code,{children:"model_dump()"})," or ",(0,r.jsx)(n.code,{children:"model_dump_json()"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"model_copy",children:(0,r.jsx)(n.code,{children:"model_copy(...)"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"model_copy()"})," allows models to be duplicated (with ",(0,r.jsx)(n.strong,{children:"optional updates"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",children:"m = FooBarModel(banana=3.14, foo='hello', bar={'whatever': 123})\r\n\r\nprint(m.model_copy(update={'banana': 0}))\r\n#> banana=0 foo='hello' bar=BarModel(whatever=123)\r\nprint(id(m.bar) == id(m.model_copy().bar))\r\n#> True\r\n# normal copy gives the same object reference for bar\r\nprint(id(m.bar) == id(m.model_copy(deep=True).bar))\r\n#> False\r\n# deep copy gives a new object reference for `bar`\n"})})]})}function p(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>o});var r=i(96540);const d={},l=r.createContext(d);function s(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);